var html5Upload=function(){"use strict";function a(a){var b=this;b.dropContainer=a.dropContainer,b.inputField=a.inputField,b.uploadsQueue=[],b.activeUploads=0,b.data=a.data,b.key=a.key,b.maxSimultaneousUploads=a.maxSimultaneousUploads||-1,b.onFileAdded=a.onFileAdded||e,b.uploadUrl=a.uploadUrl,b.onFileAddedProxy=function(a){f.log("Event: onFileAdded, file: "+a.fileName),b.onFileAdded(a)},b.initialize()}function b(a){var b=this;b.file=a,b.fileName=a.name,b.fileSize=a.size,b.uploadSize=a.size,b.uploadedBytes=0,b.eventHandlers={},b.events={onProgress:function(a,c){var d=c/a*100;f.log("Event: upload onProgress, progress = "+d+", fileSize = "+a+", uploadedBytes = "+c),(b.eventHandlers.onProgress||e)(d,a,c)},onStart:function(){f.log("Event: upload onStart"),(b.eventHandlers.onStart||e)()},onCompleted:function(c){f.log("Event: upload onCompleted, data = "+c),a=null,(b.eventHandlers.onCompleted||e)(c)}}}var c,d={},e=function(){},f=window.console||{log:e};return b.prototype={on:function(a){this.eventHandlers=a}},a.prototype={initialize:function(){f.log("Initializing upload manager");var a=this,b=a.dropContainer,c=a.inputField,d=function(a){a.preventDefault(),a.stopPropagation()},e=function(a){d(a),b.classList.add("drag-over")},g=function(a){d(a),b.classList.remove("drag-over")};b&&(a.on(b,"dragenter",e),a.on(b,"dragover",e),a.on(b,"dragleave",g),a.on(b,"drop",function(b){d(b),g(b),a.processFiles(b.dataTransfer.files)})),c&&a.on(c,"change",function(){a.processFiles(this.files)})},processFiles:function(a){f.log("Processing files: "+a.length);var c,d,e,g=this,h=a.length;for(e=0;h>e;e+=1){if(c=a[e],0===c.size){alert("Files with files size zero cannot be uploaded or multiple file uploads are not supported by your browser");break}d=new b(c),g.uploadFile(d)}},uploadFile:function(a){var b=this;return b.onFileAdded(a),b.activeUploads===b.maxSimultaneousUploads?(f.log("Queue upload: "+a.fileName),void b.uploadsQueue.push(a)):void b.ajaxUpload(a)},ajaxUpload:function(a){var b,c,d,e,g=this,h=a.file,i=g.data,j=g.key||"file";if(f.log("Beging upload: "+a.fileName),g.activeUploads+=1,b=new window.XMLHttpRequest,c=new window.FormData,d=h.name,b.open("POST",g.uploadUrl),b.upload.onloadstart=function(){f.log("Upload started: "+d),a.events.onStart()},b.upload.onprogress=function(b){b.lengthComputable&&a.events.onProgress(b.total,b.loaded)},b.onload=function(b){f.log("Upload completed: "+d),g.activeUploads-=1,a.events.onCompleted(b.target.responseText),g.uploadsQueue.length&&g.ajaxUpload(g.uploadsQueue.shift())},b.onerror=function(){f.log("Upload failed: ",a.fileName)},i)for(e in i)i.hasOwnProperty(e)&&(f.log("Adding data: "+e+" = "+i[e]),c.append(e,i[e]));c.append(j,h),b.send(c)},on:function(a,b,c){a&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c)}},d.fileApiSupported=function(){if("boolean"!=typeof c){var a=document.createElement("input");a.setAttribute("type","file"),c=!!a.files}return c},d.initialize=function(b){return new a(b)},d}();