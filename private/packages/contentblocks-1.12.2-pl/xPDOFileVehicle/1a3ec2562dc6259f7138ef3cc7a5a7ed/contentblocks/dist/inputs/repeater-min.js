!function(m,f){f.fieldTypes.repeater=function(t,o){var i=t.find(".contentblocks-repeater-wrapper"),c=tmpl("contentblocks-repeater-item"),a=o.properties&&o.properties.max_items?o.properties.max_items:0,s=o.properties&&o.properties.min_items?o.properties.min_items:0,n=!o.properties||void 0===o.properties.add_first_item||f.toBoolean(o.properties.add_first_item),l=i.siblings(".contentblocks-field-actions-bottom, .contentblocks-field-actions-top"),r=0;m.each(o.subfields,function(e,t){r+=parseInt(t.parent_properties.width)});var d=100<r?"multirow":"",p={init:function(){if(o.rows&&m.isArray(o.rows)&&0<o.rows.length)m.each(o.rows,function(e,t){p.addRow(t)});else if(1<s)for(var e=0;e<s;e++)this.addRow();else n&&this.addRow();0<s&&s===a&&(t.addClass("contentblocks-repeater-fixed-count"),1==s&&t.addClass("contentblocks-repeater-single-item")),l.on("click",".contentblocks-repeater-add-item",p.addEmptyRow),t.on("click",".contentblocks-repeater-delete-row",p.deleteRow),t.find("> .contentblocks-field-wrap > .contentblocks-field").on("click","> .contentblocks-repeater-expanded",function(){m(this).removeClass("contentblocks-repeater-expanded").addClass("contentblocks-repeater-collapsed").text("+").closest(".contentblocks-field-repeater").children(".contentblocks-repeater-wrapper").slideUp(300,function(){f.fixColumnHeights()})}).on("click","> .contentblocks-repeater-collapsed",function(){m(this).removeClass("contentblocks-repeater-collapsed").addClass("contentblocks-repeater-expanded").text("-").closest(".contentblocks-field-repeater").children(".contentblocks-repeater-wrapper").slideDown(300,function(){f.fixColumnHeights()})}),t.on("click","> .contentblocks-field-wrap > .contentblocks-field > .contentblocks-repeater-wrapper > .contentblocks-repeater-row > .contentblocks-repeater-item-expanded",function(){m(this).removeClass("contentblocks-repeater-item-expanded").addClass("contentblocks-repeater-item-collapsed").text("+").closest(".contentblocks-repeater-row").children(".contentblocks-repeater-item-wrapper").slideUp(300,function(){f.fixColumnHeights()})}).on("click","> .contentblocks-field-wrap > .contentblocks-field > .contentblocks-repeater-wrapper > .contentblocks-repeater-row > .contentblocks-repeater-item-collapsed",function(){m(this).removeClass("contentblocks-repeater-item-collapsed").addClass("contentblocks-repeater-item-expanded").text("-").closest(".contentblocks-repeater-row").children(".contentblocks-repeater-item-wrapper").slideDown(300,function(){f.fixColumnHeights()})}),("0"===a||0===a||1<a)&&i.sortable({items:"> li",forceHelperSize:!0,forcePlaceholderSize:!0,placeholder:"ui-sortable-placeholder",tolerance:"pointer",cursor:"move",cancel:"input,textarea,button,select,option,.prevent-drag",update:function(e,t){t.item.trigger("contentblocks:field_dragged"),f.fixColumnHeights(),f.fireChange()},start:function(e,t){var o;t.placeholder.height(t.item.height()),!window.CKEDITOR||0<(o=t.item.find(".cke")).length&&(o=o.attr("id").replace("cke_",""),console.log(o,CKEDITOR.instances[o]),CKEDITOR.instances[o]&&(t.item.data("ckeditor-id",o),t.item.data("ckeditor-config",CKEDITOR.instances[o].config),CKEDITOR.instances[o].destroy(),CKEDITOR.remove(o)))},stop:function(e,t){var o,n,r;window.tinymce&&(0<(o=t.item.find(".mceEditor")).length&&(n=m(o[0]).attr("id").replace("textarea_parent","textarea"),tinymce.execCommand("mceRemoveControl",!0,n),tinymce.execCommand("mceAddControl",!0,n)),0<(n=t.item.find(".mce-tinymce")).length&&(r=n.siblings("textarea").attr("id"),tinymce.execCommand("mceRemoveEditor",!0,r),tinymce.execCommand("mceAddEditor",!0,r))),window.CKEDITOR&&(r=t.item.data("ckeditor-id"),t=t.item.data("ckeditor-config"),r&&CKEDITOR.replace(r,t))}})},deleteRow:function(){var e=i.children().length;s<e&&(m(this).closest(".contentblocks-repeater-row").remove(),e--),0<a&&e==a-1&&l.find(".contentblocks-repeater-add-item").show(),f.fixColumnHeights()},addEmptyRow:function(){if(0<a){var e=i.children().length;if(a<=e)return void f.alert(_("contentblocks.repeater.max_items_reached",{max:a}))}p.addRow({},m(this).data("target"))},addRow:function(n,e){n=n||{};var r=m(c({})).addClass(d);e&&"bottom"!=e?i.prepend(r):i.append(r),m.each(o.subfields,function(e,t){var o=m.extend(!0,{},t);n[t.parent_properties.key]&&(o=m.extend(!0,{},o,n[t.parent_properties.key]));t=f.addField(r.children("ul"),t.id,o,"bottom");0<o.parent_properties.width&&t.css("width",o.parent_properties.width+"%"),t.data("repeater-key",o.parent_properties.key)});e=i.children().length;0<a&&e==a&&l.find(".contentblocks-repeater-add-item").hide(),0<s&&s<e&&t.find(".contentblocks-repeater-delete-row").show(),f.fixColumnHeights()},getData:function(){var o=[];return i.children(".contentblocks-repeater-row").each(function(e,t){var r={};(t=m(t)).children("ul").children("li").each(function(e,t){var o=(t=m(t)).attr("id"),n=f.generatedContentFields[o],t=t.data("repeater-key");n?((n=n.getData()).fieldId=o,r[t]=n):console&&console.error("input not found with id",o)}),o.push(r)}),{rows:o}}};return p}}(vcJquery,ContentBlocks);
//# sourceMappingURL=repeater-min.js.map